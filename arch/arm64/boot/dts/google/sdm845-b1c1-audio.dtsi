/* AUDIO: RESET: GPIO64, INTR1: GPIO54, INTR2: GPIO53, EXT_CLK: PM845.68 LN_BB_CLK3, SLIMBUS_CLK: GPIO70, SLIMBUS_DATA[0..1]: GPIO71,GPIO72 */

#include <dt-bindings/clock/qcom,audio-ext-clk.h>
#include "../qcom/sdm845-audio-overlay.dtsi"

/ {
	aliases {
		spi0 = &qupv3_se7_spi;
	};
};

&pm8998_gpios {
	gpio@cc00 { /* GPIO 13 */
		status = "disabled";
	};
};

&slim_aud {
	tavil_codec {
		/delete-node/ swr_master;
	};
};

&tlmm {
	cs35l36_pins {
		cs35l36_reset_top: cs35l36_reset_top {
			mux {
				pins = "gpio75";
				function = "gpio";
			};

			config {
				pins = "gpio75";
				drive-strength = <2>;
				bias-disable;
			};
		};

		cs35l36_irq_top: cs35l36_irq_top {
			mux {
				pins = "gpio40";
				function = "gpio";
			};

			config {
				pins = "gpio40";
				drive-strength = <2>;
				bias-pull-up;
			};
		};
		cs35l36_reset_bottom: cs35l36_reset_bottom {
			mux {
				pins = "gpio112";
				function = "gpio";
			};

			config {
				pins = "gpio112";
				drive-strength = <2>;
				bias-disable;
			};
		};

		cs35l36_irq_bottom: cs35l36_irq_bottom {
			mux {
				pins = "gpio115";
				function = "gpio";
			};

			config {
				pins = "gpio115";
				drive-strength = <2>;
				bias-pull-up;
			};
		};
	};
};

&soc {
	clock_audio_lnbb: audio_ext_clk_lnbb {
		status = "ok";
		compatible = "qcom,audio-ref-clk";
		clock-names = "osr_clk";
		clocks = <&clock_rpmh RPMH_LN_BB_CLK3>;
		qcom,node_has_rpm_clock;
		#clock-cells = <1>;
	};

	sound-tavil {
		qcom,model = "sdm845-tavil-b1-snd-card";
		qcom,audio-routing =
			"AIF4 VI", "MCLK",
			"RX_BIAS", "MCLK",
			"MADINPUT", "MCLK",
			"AMIC1", "Flicker Mic",
			"DMIC0", "MIC BIAS1",
			"MIC BIAS1", "Digital Mic0",
			"DMIC3", "MIC BIAS3",
			"MIC BIAS3", "Digital Mic1",
			"DMIC4", "MIC BIAS4",
			"MIC BIAS4", "Digital Mic2";

		qcom,msm-mbhc-hphl-swh = <0>;
		qcom,msm-mbhc-gnd-swh = <0>;
		qcom,wsa-max-devs = <0>;
		/delete-property/ qcom,hph-en0-gpio;
		/delete-property/ qcom,hph-en1-gpio;
		/delete-property/ qcom,wsa-devs;
		/delete-property/ qcom,wsa-aux-dev-prefix;

		pinctrl-names = "quat-mi2s-active", "quat-mi2s-sleep",
				"quat-tdm-active", "quat-tdm-sleep";
		pinctrl-0 = <&quat_mi2s_active &quat_mi2s_sd0_active
					&quat_mi2s_sd1_active>;
		pinctrl-1 = <&quat_mi2s_sleep &quat_mi2s_sd0_sleep
					&quat_mi2s_sd1_sleep>;
		pinctrl-2 = <&quat_tdm_active &quat_tdm_dout_active
					&quat_tdm_din_active>;
		pinctrl-3 = <&quat_tdm_sleep &quat_tdm_dout_sleep
					&quat_tdm_din_sleep>;
	};

	wcd_usbc_analog_en1_gpio: msm_cdc_pinctrl@49 {
		status = "disabled";
	};

	qcom,msm-dai-tdm-quat-rx {
		compatible = "qcom,msm-dai-tdm";
		qcom,msm-cpudai-tdm-group-id = <37168>;
		qcom,msm-cpudai-tdm-group-num-ports = <1>;
		qcom,msm-cpudai-tdm-group-port-id = <36912>;
		qcom,msm-cpudai-tdm-clk-rate = <12288000>;
		qcom,msm-cpudai-tdm-clk-internal = <1>;
		qcom,msm-cpudai-tdm-sync-mode = <0>;
		qcom,msm-cpudai-tdm-sync-src = <1>;
		qcom,msm-cpudai-tdm-data-out = <0>;
		qcom,msm-cpudai-tdm-invert-sync = <0>;
		qcom,msm-cpudai-tdm-data-delay = <1>;
		dai_quat_tdm_rx_0: qcom,msm-dai-q6-tdm-quat-rx-0 {
			compatible = "qcom,msm-dai-q6-tdm";
			qcom,msm-cpudai-tdm-dev-id = <36912>;
			qcom,msm-cpudai-tdm-data-align = <0>;
			qcom,msm-cpudai-tdm-header-start-offset = <0>;
			qcom,msm-cpudai-tdm-header-width = <2>;
			qcom,msm-cpudai-tdm-header-num-frame-repeat = <8>;
		};
	};

	qcom,msm-dai-tdm-quat-tx {
		compatible = "qcom,msm-dai-tdm";
		qcom,msm-cpudai-tdm-group-id = <37169>;
		qcom,msm-cpudai-tdm-group-num-ports = <1>;
		qcom,msm-cpudai-tdm-group-port-id = <36913>;
		qcom,msm-cpudai-tdm-clk-rate = <12288000>;
		qcom,msm-cpudai-tdm-clk-internal = <1>;
		qcom,msm-cpudai-tdm-sync-mode = <0>;
		qcom,msm-cpudai-tdm-sync-src = <1>;
		qcom,msm-cpudai-tdm-data-out = <0>;
		qcom,msm-cpudai-tdm-invert-sync = <0>;
		qcom,msm-cpudai-tdm-data-delay = <1>;
		dai_quat_tdm_tx_0: qcom,msm-dai-q6-tdm-quat-tx-0 {
			compatible = "qcom,msm-dai-q6-tdm";
			qcom,msm-cpudai-tdm-dev-id = <36913>;
			qcom,msm-cpudai-tdm-data-align = <0>;
		};
	};
};

&routing {
	qcom,msm-pcm-config = "b1";
};

/* path to speaker boosters */
&dai_quat_tdm_rx_0 {
	pinctrl-names = "default", "sleep";
	pinctrl-2 = <&quat_tdm_active &quat_tdm_dout_active
			&quat_tdm_din_active>;
	pinctrl-3 = <&quat_tdm_sleep &quat_tdm_dout_sleep
			&quat_tdm_din_sleep>;
};

&dai_quat_tdm_tx_0 {
	pinctrl-names = "default", "sleep";
	pinctrl-2 = <&quat_tdm_active &quat_tdm_dout_active
			&quat_tdm_din_active>;
	pinctrl-3 = <&quat_tdm_sleep &quat_tdm_dout_sleep
			&quat_tdm_din_sleep>;
};

/* speaker boosters */
&qupv3_se12_i2c {
	status = "ok";
	cs35l36_codec1: cs35l36@40 {
		/* bottom speaker - portrait right */
		compatible = "cirrus,cs35l36";
		reg = <0x40>;
		reset-gpios = <&tlmm 112 0>;
		irq-gpio = <&tlmm 115 0>;
		VA-supply = <&pm8998_s4>;
		interrupt-parent = <&tlmm>;
		interrupts = <115 IRQ_TYPE_LEVEL_LOW>;
		pinctrl-names = "default";
		pinctrl-0 = <&cs35l36_reset_bottom &cs35l36_irq_bottom>;
		cirrus,right-channel-amp;
		cirrus,boost-ind-nanohenry = <1000>;
		cirrus,boost-ctrl-select = <0x00>;
		cirrus,boost-ctl-millivolt = <10000>;
		cirrus,boost-peak-milliamp = <4500>;
		cirrus,amp-gain-zc;
		cirrus,ldm-mode-select = <0x01>;
		cirrus,pdm-ldm-exit;
		cirrus,pdm-ldm-enter;
		cirrus,weak-fet-delay = <0x04>;
		cirrus,weak-fet-thld = <0x01>;
		cirrus,temp-warn-threshold = <0x01>;

		cirrus,irq-config {
			cirrus,irq-drive-select = <0x01>;
			cirrus,irq-polarity = <0x01>;
			cirrus,irq-gpio-select = <0x01>;
			cirrus,irq-output-enable = <0x01>;
			cirrus,irq-src-select = <0x01>;
		};

		cirrus,asp-tx-config {
			cirrus,tx1-config = /bits/ 8 <0x00 0x18>;
			cirrus,tx2-config = /bits/ 8 <0x01 0x19>;
			cirrus,tx3-config = /bits/ 8 <0x02 0x28>;
		};
	};

	cs35l36_codec2: cs35l36@41 {
		/* top speaker - portrait left */
		compatible = "cirrus,cs35l36";
		reg = <0x41>;
		reset-gpios = <&tlmm 75 0>;
		irq-gpio = <&tlmm 40 0>;
		VA-supply = <&pm8998_s4>;
		interrupt-parent = <&tlmm>;
		interrupts = <40 IRQ_TYPE_LEVEL_LOW>;
		pinctrl-names = "default";
		pinctrl-0 = <&cs35l36_reset_top &cs35l36_irq_top>;
		cirrus,left-channel-amp;
		cirrus,boost-ind-nanohenry = <1000>;
		cirrus,boost-ctrl-select = <0x00>;
		cirrus,boost-ctl-millivolt = <10000>;
		cirrus,boost-peak-milliamp = <4500>;
		cirrus,amp-gain-zc;
		cirrus,ldm-mode-select = <0x01>;
		cirrus,pdm-ldm-exit;
		cirrus,pdm-ldm-enter;
		cirrus,weak-fet-delay = <0x04>;
		cirrus,weak-fet-thld = <0x01>;
		cirrus,temp-warn-threshold = <0x01>;

		cirrus,irq-config {
			cirrus,irq-drive-select = <0x01>;
			cirrus,irq-polarity = <0x01>;
			cirrus,irq-gpio-select = <0x01>;
			cirrus,irq-output-enable = <0x01>;
			cirrus,irq-src-select = <0x01>;
		};

		cirrus,asp-tx-config {
			cirrus,tx4-config = /bits/ 8 <0x03 0x18>;
			cirrus,tx5-config = /bits/ 8 <0x04 0x19>;
			cirrus,tx6-config = /bits/ 8 <0x05 0x28>;
		};
	};
};
